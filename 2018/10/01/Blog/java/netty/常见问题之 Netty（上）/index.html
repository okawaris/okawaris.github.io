<!DOCTYPE html><html lang="zh-tw"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content="å¸¸è§é—®é¢˜ä¹‹ Nettyï¼ˆä¸Šï¼‰"><meta name="keywords" content="NIO"><meta name="author" content="Jia Xufeng"><meta name="copyright" content="Jia Xufeng"><title>å¸¸è§é—®é¢˜ä¹‹ Nettyï¼ˆä¸Šï¼‰ | æš—å¤œç²¾çµã®Blog</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.7.0"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.7.0"><meta name="format-detection" content="telephone=no"><meta http-equiv="x-dns-prefetch-control" content="on"><link rel="dns-prefetch" href="https://cdn.jsdelivr.net"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://v1.hitokoto.cn/?encode=js&amp;charset=utf-8&amp;select=.footer_custom_text" defer></script><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.3.0"></head><body><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar" data-display="true"><div class="toggle-sidebar-info text-center"><span data-toggle="Toggle article">Toggle site</span><hr></div><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#BIO-NIO%E5%92%8CAIO%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">1.</span> <span class="toc-text">BIO,NIOå’ŒAIOçš„åŒºåˆ«</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Netty-%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">Netty æ˜¯ä»€ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E5%95%A5%E4%B8%8D%E7%9B%B4%E6%8E%A5%E7%94%A8NIO%E5%91%A2"><span class="toc-number">3.</span> <span class="toc-text">ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8-Netty%EF%BC%9F"><span class="toc-number">4.</span> <span class="toc-text">ä¸ºä»€ä¹ˆè¦ç”¨ Nettyï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%82%A3%E4%BA%9B%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%94%A8%E5%88%B0%E4%BA%86Netty"><span class="toc-number">5.</span> <span class="toc-text">é‚£äº›å¼€æºé¡¹ç›®ç”¨åˆ°äº†Netty?</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D%E4%B8%80%E4%B8%8BNetty%E7%9A%84%E6%A0%B8%E5%BF%83%E7%BB%84%E4%BB%B6%EF%BC%9F"><span class="toc-number">6.</span> <span class="toc-text">ä»‹ç»ä¸€ä¸‹Nettyçš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Bytebuf%EF%BC%88%E5%AD%97%E8%8A%82%E5%AE%B9%E5%99%A8%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">Bytebufï¼ˆå­—èŠ‚å®¹å™¨ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Bootstrap-%E5%92%8C-ServerBootstrap%EF%BC%88%E5%90%AF%E5%8A%A8%E5%BC%95%E5%AF%BC%E7%B1%BB%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">Bootstrap å’Œ ServerBootstrapï¼ˆå¯åŠ¨å¼•å¯¼ç±»ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Channel%EF%BC%88%E7%BD%91%E7%BB%9C%E6%93%8D%E4%BD%9C%E6%8A%BD%E8%B1%A1%E7%B1%BB%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">Channelï¼ˆç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#EventLoop%EF%BC%88%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF%EF%BC%89"><span class="toc-number">6.4.</span> <span class="toc-text">EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#EventLoop-%E4%BB%8B%E7%BB%8D"><span class="toc-number">6.4.1.</span> <span class="toc-text">EventLoop ä»‹ç»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Channel-%E5%92%8C-EventLoop-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">6.4.2.</span> <span class="toc-text">Channel å’Œ EventLoop çš„å…³ç³»</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#EventloopGroup-%E5%92%8C-EventLoop-%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-number">6.4.3.</span> <span class="toc-text">EventloopGroup å’Œ EventLoop çš„å…³ç³»</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ChannelHandler%EF%BC%88%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E5%99%A8%EF%BC%89-%E5%92%8C-ChannelPipeline%EF%BC%88ChannelHandler-%E5%AF%B9%E8%B1%A1%E9%93%BE%E8%A1%A8%EF%BC%89"><span class="toc-number">6.5.</span> <span class="toc-text">ChannelHandlerï¼ˆæ¶ˆæ¯å¤„ç†å™¨ï¼‰ å’Œ ChannelPipelineï¼ˆChannelHandler å¯¹è±¡é“¾è¡¨ï¼‰</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ChannelFuture%EF%BC%88%E6%93%8D%E4%BD%9C%E6%89%A7%E8%A1%8C%E7%BB%93%E6%9E%9C%EF%BC%89"><span class="toc-number">6.6.</span> <span class="toc-text">ChannelFutureï¼ˆæ“ä½œæ‰§è¡Œç»“æœï¼‰</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Bootstrap-%E5%92%8C-ServerBootstrap-%E4%BA%86%E8%A7%A3%E4%B9%88%EF%BC%9F"><span class="toc-number">7.</span> <span class="toc-text">Bootstrap å’Œ ServerBootstrap äº†è§£ä¹ˆï¼Ÿ</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#NioEventLoopGroup-%E9%BB%98%E8%AE%A4%E7%9A%84%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E4%BC%9A%E8%B5%B7%E5%A4%9A%E5%B0%91%E7%BA%BF%E7%A8%8B%EF%BC%9F"><span class="toc-number">8.</span> <span class="toc-text">NioEventLoopGroup é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹ï¼Ÿ</span></a></li></ol></div></div><div class="author-info hide"><div class="author-info__avatar text-center"><img src="http://image.icool8.cn/bolg/20210107112538.png"></div><div class="author-info__name text-center">Jia Xufeng</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">89</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">85</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">31</span></a></div><hr><div class="author-info-links"><div class="author-info-links__title text-center">å‹æƒ…é“¾æ¥</div><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="http://wiliam.me/">wiliam</a><a class="author-info-links__name text-center" target="_blank" rel="noopener" href="https://molunerfinn.com/hexo-theme-melody-doc/zh-Hans/">melody</a></div></div></div><div id="content-outer"><div id="top-container" style="background-image: url(http://image.icool8.cn/bolg/20210107113114.png)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">æš—å¤œç²¾çµã®Blog</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus">   <a class="site-page" href="/">ä¸»é¡µ</a><a class="site-page" href="/archives">æ–‡ç« </a><a class="site-page" href="/tags">æ ‡ç­¾</a><a class="site-page" href="/categories">åˆ†ç±»</a></span><span class="pull-right"></span></div><div id="post-info"><div id="post-title">å¸¸è§é—®é¢˜ä¹‹ Nettyï¼ˆä¸Šï¼‰</div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2018-10-01</time><span class="post-meta__separator">|</span><i class="fa fa-inbox post-meta__icon" aria-hidden="true"></i><a class="post-meta__categories" href="/categories/Netty/">Netty</a></div></div></div><div class="layout" id="content-inner"><article id="post"><div class="article-container" id="post-content"><h2 id="BIO-NIOå’ŒAIOçš„åŒºåˆ«"><a href="#BIO-NIOå’ŒAIOçš„åŒºåˆ«" class="headerlink" title="BIO,NIOå’ŒAIOçš„åŒºåˆ«"></a>BIO,NIOå’ŒAIOçš„åŒºåˆ«</h2><p><img src="http://image.icool8.cn/blog/20201206/Cr2IlvgQavAA.png?imageslim" alt="mark"></p>
<ul>
<li><strong>BIO (Blocking I/O):</strong> åŒæ­¥é˜»å¡ I/O æ¨¡å¼ï¼Œæ•°æ®çš„è¯»å–å†™å…¥å¿…é¡»é˜»å¡åœ¨ä¸€ä¸ªçº¿ç¨‹å†…ç­‰å¾…å…¶å®Œæˆã€‚åœ¨å®¢æˆ·ç«¯è¿æ¥æ•°é‡ä¸é«˜çš„æƒ…å†µä¸‹ï¼Œæ˜¯æ²¡é—®é¢˜çš„ã€‚ä½†æ˜¯ï¼Œå½“é¢å¯¹åä¸‡ç”šè‡³ç™¾ä¸‡çº§è¿æ¥çš„æ—¶å€™ï¼Œä¼ ç»Ÿçš„ BIO æ¨¡å‹æ˜¯æ— èƒ½ä¸ºåŠ›çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ›´é«˜æ•ˆçš„ I/O å¤„ç†æ¨¡å‹æ¥åº”å¯¹æ›´é«˜çš„å¹¶å‘é‡ã€‚</li>
<li><strong>NIO (Non-blocking/New I/O):</strong> NIO æ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„ I/O æ¨¡å‹ï¼Œäº Java 1.4 ä¸­å¼•å…¥ï¼Œå¯¹åº” java.nio åŒ…ï¼Œæä¾›äº† Channel , Selectorï¼ŒBuffer ç­‰æŠ½è±¡ã€‚NIO ä¸­çš„ N å¯ä»¥ç†è§£ä¸º Non-blockingï¼Œä¸å•çº¯æ˜¯ Newã€‚å®ƒæ”¯æŒé¢å‘ç¼“å†²çš„ï¼ŒåŸºäºé€šé“çš„ I/O æ“ä½œæ–¹æ³•ã€‚ NIO æä¾›äº†ä¸ä¼ ç»Ÿ BIO æ¨¡å‹ä¸­çš„ <code>Socket</code> å’Œ <code>ServerSocket</code> ç›¸å¯¹åº”çš„ <code>SocketChannel</code> å’Œ <code>ServerSocketChannel</code> ä¸¤ç§ä¸åŒçš„å¥—æ¥å­—é€šé“å®ç°,ä¸¤ç§é€šé“éƒ½æ”¯æŒé˜»å¡å’Œéé˜»å¡ä¸¤ç§æ¨¡å¼ã€‚å¯¹äºé«˜è´Ÿè½½ã€é«˜å¹¶å‘çš„ï¼ˆç½‘ç»œï¼‰åº”ç”¨ï¼Œåº”ä½¿ç”¨ NIO çš„éé˜»å¡æ¨¡å¼æ¥å¼€å‘</li>
<li><strong>AIO (Asynchronous I/O):</strong> AIO ä¹Ÿå°±æ˜¯ NIO 2ã€‚åœ¨ Java 7 ä¸­å¼•å…¥äº† NIO çš„æ”¹è¿›ç‰ˆ NIO 2,å®ƒæ˜¯å¼‚æ­¥éé˜»å¡çš„ IO æ¨¡å‹ã€‚å¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚AIO æ˜¯å¼‚æ­¥ IO çš„ç¼©å†™ï¼Œè™½ç„¶ NIO åœ¨ç½‘ç»œæ“ä½œä¸­ï¼Œæä¾›äº†éé˜»å¡çš„æ–¹æ³•ï¼Œä½†æ˜¯ NIO çš„ IO è¡Œä¸ºè¿˜æ˜¯åŒæ­¥çš„ã€‚å¯¹äº NIO æ¥è¯´ï¼Œæˆ‘ä»¬çš„ä¸šåŠ¡çº¿ç¨‹æ˜¯åœ¨ IO æ“ä½œå‡†å¤‡å¥½æ—¶ï¼Œå¾—åˆ°é€šçŸ¥ï¼Œæ¥ç€å°±ç”±è¿™ä¸ªçº¿ç¨‹è‡ªè¡Œè¿›è¡Œ IO æ“ä½œï¼ŒIO æ“ä½œæœ¬èº«æ˜¯åŒæ­¥çš„ã€‚æŸ¥é˜…ç½‘ä¸Šç›¸å…³èµ„æ–™ï¼Œæˆ‘å‘ç°å°±ç›®å‰æ¥è¯´ AIO çš„åº”ç”¨è¿˜ä¸æ˜¯å¾ˆå¹¿æ³›ï¼ŒNetty ä¹‹å‰ä¹Ÿå°è¯•ä½¿ç”¨è¿‡ AIOï¼Œä¸è¿‡åˆæ”¾å¼ƒäº†ã€‚</li>
</ul>
<a id="more"></a>

<p><strong>åŒæ­¥å’Œå¼‚æ­¥è¯´çš„æ˜¯IOæ“ä½œï¼Œé˜»å¡éé˜»å¡è¯´çš„æ˜¯çº¿ç¨‹çš„çŠ¶æ€ ã€‚</strong></p>
<h2 id="Netty-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#Netty-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="Netty æ˜¯ä»€ä¹ˆï¼Ÿ"></a>Netty æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šé‚£ä½ å†æ¥ä»‹ç»ä¸€ä¸‹è‡ªå·±å¯¹ Netty çš„è®¤è¯†å§ï¼å°ä¼™å­ã€‚</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå¥½çš„ï¼é‚£æˆ‘å°±ç®€å•ç”¨ 3 ç‚¹æ¥æ¦‚æ‹¬ä¸€ä¸‹ Netty å§ï¼</p>
<ol>
<li>Netty æ˜¯ä¸€ä¸ª <strong>åŸºäº NIO</strong> çš„ client-server(å®¢æˆ·ç«¯æœåŠ¡å™¨)æ¡†æ¶ï¼Œä½¿ç”¨å®ƒå¯ä»¥å¿«é€Ÿç®€å•åœ°å¼€å‘ç½‘ç»œåº”ç”¨ç¨‹åºã€‚</li>
<li>å®ƒæå¤§åœ°ç®€åŒ–å¹¶ä¼˜åŒ–äº† TCP å’Œ UDP å¥—æ¥å­—æœåŠ¡å™¨ç­‰ç½‘ç»œç¼–ç¨‹,å¹¶ä¸”æ€§èƒ½ä»¥åŠå®‰å…¨æ€§ç­‰å¾ˆå¤šæ–¹é¢ç”šè‡³éƒ½è¦æ›´å¥½ã€‚</li>
<li><strong>æ”¯æŒå¤šç§åè®®</strong> å¦‚ FTPï¼ŒSMTPï¼ŒHTTP ä»¥åŠå„ç§äºŒè¿›åˆ¶å’ŒåŸºäºæ–‡æœ¬çš„ä¼ ç»Ÿåè®®ã€‚</li>
</ol>
<p>ç”¨å®˜æ–¹çš„æ€»ç»“å°±æ˜¯ï¼š<strong>Netty æˆåŠŸåœ°æ‰¾åˆ°äº†ä¸€ç§åœ¨ä¸å¦¥åå¯ç»´æŠ¤æ€§å’Œæ€§èƒ½çš„æƒ…å†µä¸‹å®ç°æ˜“äºå¼€å‘ï¼Œæ€§èƒ½ï¼Œç¨³å®šæ€§å’Œçµæ´»æ€§çš„æ–¹æ³•ã€‚</strong></p>
<p><em>ç½‘ç»œç¼–ç¨‹æˆ‘æ„¿æ„ç§°ä¸­ Netty ä¸ºç‹ ã€‚</em></p>
<h2 id="ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢"><a href="#ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢" class="headerlink" title="ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢?"></a>ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢?</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šä½ ä¸Šé¢ä¹Ÿè¯´äº†NettyåŸºäºNIOï¼Œé‚£ä¸ºå•¥ä¸ç›´æ¥ç”¨NIOå‘¢?ã€‚</p>
<p>ä¸ç”¨NIOä¸»è¦æ˜¯å› ä¸ºNIOçš„ç¼–ç¨‹æ¨¡å‹å¤æ‚è€Œä¸”å­˜åœ¨ä¸€äº›BUGï¼Œå¹¶ä¸”å¯¹ç¼–ç¨‹åŠŸåº•è¦æ±‚æ¯”è¾ƒé«˜ã€‚ä¸‹å›¾å°±æ˜¯ä¸€ä¸ªå…¸å‹çš„ä½¿ç”¨ NIO è¿›è¡Œç¼–ç¨‹çš„æ¡ˆä¾‹ï¼š</p>
<p><img src="http://image.icool8.cn/blog/20201206/TD5i94TxIbEP.png?imageslim" alt="mark"></p>
<p>è€Œä¸”ï¼ŒNIOåœ¨é¢å¯¹æ–­è¿é‡è¿ã€åŒ…ä¸¢å¤±ã€ç²˜åŒ…ç­‰é—®é¢˜æ—¶å¤„ç†è¿‡ç¨‹éå¸¸å¤æ‚ã€‚Nettyçš„å‡ºç°æ­£æ˜¯ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼Œæ›´å¤šå…³äºNettyçš„ç‰¹ç‚¹å¯ä»¥çœ‹ä¸‹é¢çš„å†…å®¹ã€‚</p>
<h2 id="ä¸ºä»€ä¹ˆè¦ç”¨-Nettyï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦ç”¨-Nettyï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦ç”¨ Nettyï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦ç”¨ Nettyï¼Ÿ</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šä¸ºä»€ä¹ˆè¦ç”¨ Netty å‘¢ï¼Ÿèƒ½ä¸èƒ½è¯´ä¸€ä¸‹è‡ªå·±çš„çœ‹æ³•ã€‚</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå› ä¸º Netty å…·æœ‰ä¸‹é¢è¿™äº›ä¼˜ç‚¹ï¼Œå¹¶ä¸”ç›¸æ¯”äºç›´æ¥ä½¿ç”¨ JDK è‡ªå¸¦çš„ NIO ç›¸å…³çš„ API æ¥è¯´æ›´åŠ æ˜“ç”¨ã€‚</p>
<ul>
<li>ç»Ÿä¸€çš„ APIï¼Œæ”¯æŒå¤šç§ä¼ è¾“ç±»å‹ï¼Œé˜»å¡å’Œéé˜»å¡çš„ã€‚</li>
<li>ç®€å•è€Œå¼ºå¤§çš„çº¿ç¨‹æ¨¡å‹ã€‚</li>
<li>è‡ªå¸¦ç¼–è§£ç å™¨è§£å†³ TCP ç²˜åŒ…/æ‹†åŒ…é—®é¢˜ã€‚</li>
<li>è‡ªå¸¦å„ç§åè®®æ ˆã€‚</li>
<li>çœŸæ­£çš„æ— è¿æ¥æ•°æ®åŒ…å¥—æ¥å­—æ”¯æŒã€‚</li>
<li>æ¯”ç›´æ¥ä½¿ç”¨ Java æ ¸å¿ƒ API æœ‰æ›´é«˜çš„ååé‡ã€æ›´ä½çš„å»¶è¿Ÿã€æ›´ä½çš„èµ„æºæ¶ˆè€—å’Œæ›´å°‘çš„å†…å­˜å¤åˆ¶ã€‚</li>
<li>å®‰å…¨æ€§ä¸é”™ï¼Œæœ‰å®Œæ•´çš„ SSL/TLS ä»¥åŠ StartTLS æ”¯æŒã€‚</li>
<li>ç¤¾åŒºæ´»è·ƒ</li>
<li>æˆç†Ÿç¨³å®šï¼Œç»å†äº†å¤§å‹é¡¹ç›®çš„ä½¿ç”¨å’Œè€ƒéªŒï¼Œè€Œä¸”å¾ˆå¤šå¼€æºé¡¹ç›®éƒ½ä½¿ç”¨åˆ°äº† Nettyï¼Œ æ¯”å¦‚æˆ‘ä»¬ç»å¸¸æ¥è§¦çš„ Dubboã€RocketMQ ç­‰ç­‰ã€‚</li>
<li>â€¦â€¦</li>
</ul>
<h2 id="é‚£äº›å¼€æºé¡¹ç›®ç”¨åˆ°äº†Netty"><a href="#é‚£äº›å¼€æºé¡¹ç›®ç”¨åˆ°äº†Netty" class="headerlink" title="é‚£äº›å¼€æºé¡¹ç›®ç”¨åˆ°äº†Netty?"></a>é‚£äº›å¼€æºé¡¹ç›®ç”¨åˆ°äº†Netty?</h2><p>æˆ‘ä»¬å¹³å¸¸ç»å¸¸æ¥è§¦çš„ Dubboã€RocketMQã€Elasticsearchã€gRPC ç­‰ç­‰éƒ½ç”¨åˆ°äº† Nettyã€‚</p>
<p>å¯ä»¥è¯´å¤§é‡çš„å¼€æºé¡¹ç›®éƒ½ç”¨åˆ°äº† Nettyï¼Œæ‰€ä»¥æŒæ¡ Netty æœ‰åŠ©äºä½ æ›´å¥½çš„ä½¿ç”¨è¿™äº›å¼€æºé¡¹ç›®å¹¶ä¸”è®©ä½ æœ‰èƒ½åŠ›å¯¹å…¶è¿›è¡ŒäºŒæ¬¡å¼€å‘ã€‚</p>
<p>å®é™…ä¸Šè¿˜æœ‰å¾ˆå¤šå¾ˆå¤šä¼˜ç§€çš„é¡¹ç›®ç”¨åˆ°äº† Netty,Netty å®˜æ–¹ä¹Ÿåšäº†ç»Ÿè®¡ï¼Œç»Ÿè®¡ç»“æœåœ¨è¿™é‡Œï¼š<a target="_blank" rel="noopener" href="https://netty.io/wiki/related-projects.html">https://netty.io/wiki/related-projects.html</a> ã€‚</p>
<h2 id="ä»‹ç»ä¸€ä¸‹Nettyçš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ"><a href="#ä»‹ç»ä¸€ä¸‹Nettyçš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ" class="headerlink" title="ä»‹ç»ä¸€ä¸‹Nettyçš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ"></a>ä»‹ç»ä¸€ä¸‹Nettyçš„æ ¸å¿ƒç»„ä»¶ï¼Ÿ</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šNetty æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Ÿåˆ†åˆ«æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šè¡¨é¢ä¸Šï¼Œå˜´ä¸Šå¼€å§‹è¯´èµ· Netty çš„æ ¸å¿ƒç»„ä»¶æœ‰å“ªäº›ï¼Œå®åˆ™ï¼Œå†…å¿ƒå·²ç»å¼€å§‹ mmp äº†ï¼Œæ·±åº¦æ€€ç–‘è¿™é¢è¯•å®˜æ˜¯å­˜å¿ƒææˆ‘å•Šï¼</p>
<p>ç®€å•ä»‹ç» Netty æœ€æ ¸å¿ƒçš„ä¸€äº›ç»„ä»¶ï¼ˆ_å¯¹äºæ¯ä¸€ä¸ªç»„ä»¶è¿™é‡Œä¸è¯¦ç»†ä»‹ç»_ï¼‰ã€‚é€šè¿‡ä¸‹é¢è¿™å¼ å›¾ä½ å¯ä»¥å°†æˆ‘æåˆ°çš„è¿™äº› Netty æ ¸å¿ƒç»„ä»¶ä¸²è”èµ·æ¥ã€‚</p>
<p><img src="http://image.icool8.cn/blog/20201206/sUhGDhjkOhHQ.png?imageslim" alt="mark"></p>
<h3 id="Bytebufï¼ˆå­—èŠ‚å®¹å™¨ï¼‰"><a href="#Bytebufï¼ˆå­—èŠ‚å®¹å™¨ï¼‰" class="headerlink" title="Bytebufï¼ˆå­—èŠ‚å®¹å™¨ï¼‰"></a>Bytebufï¼ˆå­—èŠ‚å®¹å™¨ï¼‰</h3><p><strong>ç½‘ç»œé€šä¿¡æœ€ç»ˆéƒ½æ˜¯é€šè¿‡å­—èŠ‚æµè¿›è¡Œä¼ è¾“çš„ã€‚ ByteBuf å°±æ˜¯ Netty æä¾›çš„ä¸€ä¸ªå­—èŠ‚å®¹å™¨ï¼Œå…¶å†…éƒ¨æ˜¯ä¸€ä¸ªå­—èŠ‚æ•°ç»„ã€‚</strong> å½“æˆ‘ä»¬é€šè¿‡ Netty ä¼ è¾“æ•°æ®çš„æ—¶å€™ï¼Œå°±æ˜¯é€šè¿‡ <code>ByteBuf</code> è¿›è¡Œçš„ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥å°† <code>ByteBuf</code> çœ‹ä½œæ˜¯ Netty å¯¹ Java NIO æä¾›äº† <code>ByteBuffer</code> å­—èŠ‚å®¹å™¨çš„å°è£…å’ŒæŠ½è±¡ã€‚</p>
<p>æœ‰å¾ˆå¤šå°ä¼™ä¼´å¯èƒ½å°±è¦é—®äº† ï¼š <strong>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨ Java NIO æä¾›çš„ ByteBuffer å‘¢ï¼Ÿ</strong></p>
<p>å› ä¸º <code>ByteBuffer</code> è¿™ä¸ªç±»ä½¿ç”¨èµ·æ¥è¿‡äºå¤æ‚å’Œç¹çã€‚</p>
<h3 id="Bootstrap-å’Œ-ServerBootstrapï¼ˆå¯åŠ¨å¼•å¯¼ç±»ï¼‰"><a href="#Bootstrap-å’Œ-ServerBootstrapï¼ˆå¯åŠ¨å¼•å¯¼ç±»ï¼‰" class="headerlink" title="Bootstrap å’Œ ServerBootstrapï¼ˆå¯åŠ¨å¼•å¯¼ç±»ï¼‰"></a>Bootstrap å’Œ ServerBootstrapï¼ˆå¯åŠ¨å¼•å¯¼ç±»ï¼‰</h3><p><strong>Bootstrap æ˜¯å®¢æˆ·ç«¯çš„å¯åŠ¨å¼•å¯¼ç±»/è¾…åŠ©ç±»</strong>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¼•å¯¼/è¾…åŠ©ç±»ï¼šBootstrap</span></span><br><span class="line"></span><br><span class="line">    Bootstrap b = <span class="keyword">new</span> Bootstrap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŒ‡å®šçº¿ç¨‹æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">    b.group(group).</span><br><span class="line"></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•å»ºç«‹è¿æ¥</span></span><br><span class="line"></span><br><span class="line">    ChannelFuture f = b.connect(host, port).sync();</span><br><span class="line"></span><br><span class="line">    f.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜é›…å…³é—­ç›¸å…³çº¿ç¨‹ç»„èµ„æº</span></span><br><span class="line"></span><br><span class="line">    group.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ServerBootstrap å®¢æˆ·ç«¯çš„å¯åŠ¨å¼•å¯¼ç±»/è¾…åŠ©ç±»</strong>ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 1.bossGroup ç”¨äºæ¥æ”¶è¿æ¥ï¼ŒworkerGroup ç”¨äºå…·ä½“çš„å¤„ç†</span></span><br><span class="line"></span><br><span class="line">    EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.åˆ›å»ºæœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼/è¾…åŠ©ç±»ï¼šServerBootstrap</span></span><br><span class="line"></span><br><span class="line">        ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.ç»™å¼•å¯¼ç±»é…ç½®ä¸¤å¤§çº¿ç¨‹ç»„,ç¡®å®šäº†çº¿ç¨‹æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">        b.group(bossGroup, workerGroup).</span><br><span class="line"></span><br><span class="line">               ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.ç»‘å®šç«¯å£</span></span><br><span class="line"></span><br><span class="line">        ChannelFuture f = b.bind(port).sync();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…è¿æ¥å…³é—­</span></span><br><span class="line"></span><br><span class="line">        f.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.ä¼˜é›…å…³é—­ç›¸å…³çº¿ç¨‹ç»„èµ„æº</span></span><br><span class="line"></span><br><span class="line">        bossGroup.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">        workerGroup.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p>
<ol>
<li><code>Bootstrap</code> é€šå¸¸ä½¿ç”¨ <code>connet()</code> æ–¹æ³•è¿æ¥åˆ°è¿œç¨‹çš„ä¸»æœºå’Œç«¯å£ï¼Œä½œä¸ºä¸€ä¸ª Netty TCP åè®®é€šä¿¡ä¸­çš„å®¢æˆ·ç«¯ã€‚å¦å¤–ï¼Œ<code>Bootstrap</code> ä¹Ÿå¯ä»¥é€šè¿‡ <code>bind()</code> æ–¹æ³•ç»‘å®šæœ¬åœ°çš„ä¸€ä¸ªç«¯å£ï¼Œä½œä¸º UDP åè®®é€šä¿¡ä¸­çš„ä¸€ç«¯ã€‚</li>
<li><code>ServerBootstrap</code>é€šå¸¸ä½¿ç”¨ <code>bind()</code> æ–¹æ³•ç»‘å®šæœ¬åœ°çš„ç«¯å£ä¸Šï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li>
<li><code>Bootstrap</code> åªéœ€è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹ç»„â€” <code>EventLoopGroup</code> ,è€Œ <code>ServerBootstrap</code>éœ€è¦é…ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„â€” <code>EventLoopGroup</code> ï¼Œä¸€ä¸ªç”¨äºæ¥æ”¶è¿æ¥ï¼Œä¸€ä¸ªç”¨äºå…·ä½“çš„ IO å¤„ç†ã€‚</li>
</ol>
<h3 id="Channelï¼ˆç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼‰"><a href="#Channelï¼ˆç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼‰" class="headerlink" title="Channelï¼ˆç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼‰"></a>Channelï¼ˆç½‘ç»œæ“ä½œæŠ½è±¡ç±»ï¼‰</h3><p><code>Channel</code> æ¥å£æ˜¯ Netty å¯¹ç½‘ç»œæ“ä½œæŠ½è±¡ç±»ã€‚é€šè¿‡ <code>Channel</code> æˆ‘ä»¬å¯ä»¥è¿›è¡Œ I/O æ“ä½œã€‚</p>
<p>ä¸€æ—¦å®¢æˆ·ç«¯æˆåŠŸè¿æ¥æœåŠ¡ç«¯ï¼Œå°±ä¼šæ–°å»ºä¸€ä¸ª <code>Channel</code> åŒè¯¥ç”¨æˆ·ç«¯è¿›è¡Œç»‘å®šï¼Œç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  é€šè¿‡ Bootstrap çš„ connect æ–¹æ³•è¿æ¥åˆ°æœåŠ¡ç«¯</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Channel <span class="title">doConnect</span><span class="params">(InetSocketAddress inetSocketAddress)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">     CompletableFuture&lt;Channel&gt; completableFuture = <span class="keyword">new</span> CompletableFuture&lt;&gt;();</span><br><span class="line"></span><br><span class="line">     bootstrap.connect(inetSocketAddress).addListener((ChannelFutureListener) future -&gt; &#123;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">if</span> (future.isSuccess()) &#123;</span><br><span class="line"></span><br><span class="line">             completableFuture.complete(future.channel());</span><br><span class="line"></span><br><span class="line">         &#125; <span class="keyword">else</span> &#123;</span><br><span class="line"></span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException();</span><br><span class="line"></span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">     &#125;);</span><br><span class="line"></span><br><span class="line">     <span class="keyword">return</span> completableFuture.get();</span><br><span class="line"></span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>æ¯”è¾ƒå¸¸ç”¨çš„<code>Channel</code>æ¥å£å®ç°ç±»æ˜¯ ï¼š</p>
<ul>
<li><code>NioServerSocketChannel</code>ï¼ˆæœåŠ¡ç«¯ï¼‰</li>
<li><code>NioSocketChannel</code>ï¼ˆå®¢æˆ·ç«¯ï¼‰</li>
</ul>
<p>è¿™ä¸¤ä¸ª <code>Channel</code> å¯ä»¥å’Œ BIO ç¼–ç¨‹æ¨¡å‹ä¸­çš„<code>ServerSocket</code>ä»¥åŠ<code>Socket</code>ä¸¤ä¸ªæ¦‚å¿µå¯¹åº”ä¸Šã€‚</p>
<h3 id="EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰"><a href="#EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰" class="headerlink" title="EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰"></a>EventLoopï¼ˆäº‹ä»¶å¾ªç¯ï¼‰</h3><h4 id="EventLoop-ä»‹ç»"><a href="#EventLoop-ä»‹ç»" class="headerlink" title="EventLoop ä»‹ç»"></a>EventLoop ä»‹ç»</h4><p>è¿™ä¹ˆè¯´å§ï¼<code>EventLoop</code>ï¼ˆäº‹ä»¶å¾ªç¯ï¼‰æ¥å£å¯ä»¥è¯´æ˜¯ Netty ä¸­æœ€æ ¸å¿ƒçš„æ¦‚å¿µäº†ï¼</p>
<p>ã€ŠNetty å®æˆ˜ã€‹è¿™æœ¬ä¹¦æ˜¯è¿™æ ·ä»‹ç»å®ƒçš„ï¼š</p>
<blockquote>
<p><code>EventLoop</code> å®šä¹‰äº† Netty çš„æ ¸å¿ƒæŠ½è±¡ï¼Œç”¨äºå¤„ç†è¿æ¥çš„ç”Ÿå‘½å‘¨æœŸä¸­æ‰€å‘ç”Ÿçš„äº‹ä»¶ã€‚</p>
</blockquote>
<p>æ˜¯ä¸æ˜¯å¾ˆéš¾ç†è§£ï¼Ÿè¯´å®è¯ï¼Œæˆ‘å­¦ä¹  Netty çš„æ—¶å€™çœ‹åˆ°è¿™å¥è¯æ˜¯æ²¡å¤ªèƒ½ç†è§£çš„ã€‚</p>
<p>è¯´ç™½äº†ï¼Œ<strong>EventLoop çš„ä¸»è¦ä½œç”¨å®é™…å°±æ˜¯è´£ç›‘å¬ç½‘ç»œäº‹ä»¶å¹¶è°ƒç”¨äº‹ä»¶å¤„ç†å™¨è¿›è¡Œç›¸å…³ I/O æ“ä½œï¼ˆè¯»å†™ï¼‰çš„å¤„ç†ã€‚</strong></p>
<h4 id="Channel-å’Œ-EventLoop-çš„å…³ç³»"><a href="#Channel-å’Œ-EventLoop-çš„å…³ç³»" class="headerlink" title="Channel å’Œ EventLoop çš„å…³ç³»"></a>Channel å’Œ EventLoop çš„å…³ç³»</h4><p>é‚£ <code>Channel</code> å’Œ <code>EventLoop</code> ç›´æ¥æœ‰å•¥è”ç³»å‘¢ï¼Ÿ</p>
<p><strong>Channel ä¸º Netty ç½‘ç»œæ“ä½œ(è¯»å†™ç­‰æ“ä½œ)æŠ½è±¡ç±»ï¼ŒEventLoop è´Ÿè´£å¤„ç†æ³¨å†Œåˆ°å…¶ä¸Šçš„Channel çš„ I/O æ“ä½œï¼Œä¸¤è€…é…åˆè¿›è¡Œ I/O æ“ä½œã€‚</strong></p>
<h4 id="EventloopGroup-å’Œ-EventLoop-çš„å…³ç³»"><a href="#EventloopGroup-å’Œ-EventLoop-çš„å…³ç³»" class="headerlink" title="EventloopGroup å’Œ EventLoop çš„å…³ç³»"></a>EventloopGroup å’Œ EventLoop çš„å…³ç³»</h4><p><code>EventLoopGroup</code> åŒ…å«å¤šä¸ª <code>EventLoop</code>ï¼ˆæ¯ä¸€ä¸ª <code>EventLoop</code> é€šå¸¸å†…éƒ¨åŒ…å«ä¸€ä¸ªçº¿ç¨‹ï¼‰ï¼Œå®ƒç®¡ç†ç€æ‰€æœ‰çš„ <code>EventLoop</code> çš„ç”Ÿå‘½å‘¨æœŸã€‚</p>
<p>å¹¶ä¸”ï¼Œ<strong>EventLoop å¤„ç†çš„ I/O äº‹ä»¶éƒ½å°†åœ¨å®ƒä¸“æœ‰çš„ Thread ä¸Šè¢«å¤„ç†ï¼Œå³ Thread å’Œ EventLoop å±äº 1 : 1 çš„å…³ç³»ï¼Œä»è€Œä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</strong></p>
<p>ä¸‹å›¾æ˜¯ Netty <strong>NIO</strong> æ¨¡å‹å¯¹åº”çš„ <code>EventLoop</code> æ¨¡å‹ã€‚é€šè¿‡è¿™ä¸ªå›¾åº”è¯¥å¯ä»¥å°†<code>EventloopGroup</code>ã€<code>EventLoop</code>ã€ <code>Channel</code>ä¸‰è€…è”ç³»èµ·æ¥ã€‚</p>
<p><img src="http://image.icool8.cn/blog/20201206/Iip9Gbz8o2Of.png?imageslim" alt="mark"></p>
<h3 id="ChannelHandlerï¼ˆæ¶ˆæ¯å¤„ç†å™¨ï¼‰-å’Œ-ChannelPipelineï¼ˆChannelHandler-å¯¹è±¡é“¾è¡¨ï¼‰"><a href="#ChannelHandlerï¼ˆæ¶ˆæ¯å¤„ç†å™¨ï¼‰-å’Œ-ChannelPipelineï¼ˆChannelHandler-å¯¹è±¡é“¾è¡¨ï¼‰" class="headerlink" title="ChannelHandlerï¼ˆæ¶ˆæ¯å¤„ç†å™¨ï¼‰ å’Œ ChannelPipelineï¼ˆChannelHandler å¯¹è±¡é“¾è¡¨ï¼‰"></a>ChannelHandlerï¼ˆæ¶ˆæ¯å¤„ç†å™¨ï¼‰ å’Œ ChannelPipelineï¼ˆChannelHandler å¯¹è±¡é“¾è¡¨ï¼‰</h3><p>ä¸‹é¢è¿™æ®µä»£ç ä½¿ç”¨è¿‡ Netty çš„å°ä¼™ä¼´åº”è¯¥ä¸ä¼šé™Œç”Ÿï¼Œæˆ‘ä»¬æŒ‡å®šäº†åºåˆ—åŒ–ç¼–è§£ç å™¨ä»¥åŠè‡ªå®šä¹‰çš„ <code>ChannelHandler</code> å¤„ç†æ¶ˆæ¯ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">b.group(eventLoopGroup)</span><br><span class="line"></span><br><span class="line">        .handler(<span class="keyword">new</span> ChannelInitializer&lt;SocketChannel&gt;() &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line"></span><br><span class="line">            <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initChannel</span><span class="params">(SocketChannel ch)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">                ch.pipeline().addLast(<span class="keyword">new</span> NettyKryoDecoder(kryoSerializer, RpcResponse.class));</span><br><span class="line"></span><br><span class="line">                ch.pipeline().addLast(<span class="keyword">new</span> NettyKryoEncoder(kryoSerializer, RpcRequest.class));</span><br><span class="line"></span><br><span class="line">                ch.pipeline().addLast(<span class="keyword">new</span> KryoClientHandler());</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p><strong>ChannelHandler æ˜¯æ¶ˆæ¯çš„å…·ä½“å¤„ç†å™¨ï¼Œä¸»è¦è´Ÿè´£å¤„ç†å®¢æˆ·ç«¯/æœåŠ¡ç«¯æ¥æ”¶å’Œå‘é€çš„æ•°æ®ã€‚</strong></p>
<p>å½“ <code>Channel</code> è¢«åˆ›å»ºæ—¶ï¼Œå®ƒä¼šè¢«è‡ªåŠ¨åœ°åˆ†é…åˆ°å®ƒä¸“å±çš„ <code>ChannelPipeline</code>ã€‚ ä¸€ä¸ª<code>Channel</code>åŒ…å«ä¸€ä¸ª <code>ChannelPipeline</code>ã€‚ <code>ChannelPipeline</code> ä¸º <code>ChannelHandler</code> çš„é“¾ï¼Œä¸€ä¸ª pipeline ä¸Šå¯ä»¥æœ‰å¤šä¸ª <code>ChannelHandler</code>ã€‚</p>
<p>æˆ‘ä»¬å¯ä»¥åœ¨ <code>ChannelPipeline</code> ä¸Šé€šè¿‡ <code>addLast()</code> æ–¹æ³•æ·»åŠ ä¸€ä¸ªæˆ–è€…å¤šä¸ª<code>ChannelHandler</code> ï¼ˆ_ä¸€ä¸ªæ•°æ®æˆ–è€…äº‹ä»¶å¯èƒ½ä¼šè¢«å¤šä¸ª Handler å¤„ç†_ï¼‰ ã€‚å½“ä¸€ä¸ª <code>ChannelHandler</code> å¤„ç†å®Œä¹‹åå°±å°†æ•°æ®äº¤ç»™ä¸‹ä¸€ä¸ª <code>ChannelHandler</code> ã€‚</p>
<p>å½“ <code>ChannelHandler</code> è¢«æ·»åŠ åˆ°çš„ <code>ChannelPipeline</code> å®ƒå¾—åˆ°ä¸€ä¸ª <code>ChannelHandlerContext</code>ï¼Œå®ƒä»£è¡¨ä¸€ä¸ª <code>ChannelHandler</code> å’Œ <code>ChannelPipeline</code> ä¹‹é—´çš„â€œç»‘å®šâ€ã€‚ <code>ChannelPipeline</code> é€šè¿‡ <code>ChannelHandlerContext</code>æ¥é—´æ¥ç®¡ç† <code>ChannelHandler</code> ã€‚</p>
<p><img src="http://image.icool8.cn/blog/20201206/7ApunzRPXSz7.png?imageslim" alt="mark"></p>
<h3 id="ChannelFutureï¼ˆæ“ä½œæ‰§è¡Œç»“æœï¼‰"><a href="#ChannelFutureï¼ˆæ“ä½œæ‰§è¡Œç»“æœï¼‰" class="headerlink" title="ChannelFutureï¼ˆæ“ä½œæ‰§è¡Œç»“æœï¼‰"></a>ChannelFutureï¼ˆæ“ä½œæ‰§è¡Œç»“æœï¼‰</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public interface ChannelFuture extends Future&lt;Void&gt; &#123;</span><br><span class="line">    Channel channel();</span><br><span class="line"></span><br><span class="line">    ChannelFuture addListener(GenericFutureListener&lt;? extends Future&lt;? super Void&gt;&gt; var1);</span><br><span class="line">     ......</span><br><span class="line"></span><br><span class="line">    ChannelFuture sync() throws InterruptedException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Netty æ˜¯å¼‚æ­¥éé˜»å¡çš„ï¼Œæ‰€æœ‰çš„ I/O æ“ä½œéƒ½ä¸ºå¼‚æ­¥çš„ã€‚</p>
<p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸èƒ½ç«‹åˆ»å¾—åˆ°æ“ä½œæ˜¯å¦æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ <code>ChannelFuture</code> æ¥å£çš„ <code>addListener()</code> æ–¹æ³•æ³¨å†Œä¸€ä¸ª <code>ChannelFutureListener</code>ï¼Œå½“æ“ä½œæ‰§è¡ŒæˆåŠŸæˆ–è€…å¤±è´¥æ—¶ï¼Œç›‘å¬å°±ä¼šè‡ªåŠ¨è§¦å‘è¿”å›ç»“æœã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ChannelFuture f = b.connect(host, port).addListener(future -&gt; &#123;</span><br><span class="line">  <span class="keyword">if</span> (future.isSuccess()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;è¿æ¥æˆåŠŸ!&quot;</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    System.err.println(<span class="string">&quot;è¿æ¥å¤±è´¥!&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;).sync();</span><br></pre></td></tr></table></figure>
<p>å¹¶ä¸”ï¼Œä½ è¿˜å¯ä»¥é€šè¿‡<code>ChannelFuture</code> çš„ <code>channel()</code> æ–¹æ³•è·å–è¿æ¥ç›¸å…³è”çš„<code>Channel</code> ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Channel channel = f.channel();</span><br></pre></td></tr></table></figure>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡ <code>ChannelFuture</code> æ¥å£çš„ <code>sync()</code>æ–¹æ³•è®©å¼‚æ­¥çš„æ“ä½œç¼–ç¨‹åŒæ­¥çš„ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//bind()æ˜¯å¼‚æ­¥çš„ï¼Œä½†æ˜¯ï¼Œä½ å¯ä»¥é€šè¿‡ `sync()`æ–¹æ³•å°†å…¶å˜ä¸ºåŒæ­¥ã€‚</span></span><br><span class="line"></span><br><span class="line">ChannelFuture f = b.bind(port).sync();</span><br></pre></td></tr></table></figure>
<h2 id="Bootstrap-å’Œ-ServerBootstrap-äº†è§£ä¹ˆï¼Ÿ"><a href="#Bootstrap-å’Œ-ServerBootstrap-äº†è§£ä¹ˆï¼Ÿ" class="headerlink" title="Bootstrap å’Œ ServerBootstrap äº†è§£ä¹ˆï¼Ÿ"></a>Bootstrap å’Œ ServerBootstrap äº†è§£ä¹ˆï¼Ÿ</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šä½ å†è¯´è¯´è‡ªå·±å¯¹ <code>Bootstrap</code> å’Œ <code>ServerBootstrap</code> çš„äº†è§£å§ï¼</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼š</p>
<p><code>Bootstrap</code> æ˜¯å®¢æˆ·ç«¯çš„å¯åŠ¨å¼•å¯¼ç±»/è¾…åŠ©ç±»ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">EventLoopGroup group = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºå®¢æˆ·ç«¯å¯åŠ¨å¼•å¯¼/è¾…åŠ©ç±»ï¼šBootstrap</span></span><br><span class="line"></span><br><span class="line">    Bootstrap b = <span class="keyword">new</span> Bootstrap();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//æŒ‡å®šçº¿ç¨‹æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">    b.group(group).</span><br><span class="line"></span><br><span class="line">            ......</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°è¯•å»ºç«‹è¿æ¥</span></span><br><span class="line"></span><br><span class="line">    ChannelFuture f = b.connect(host, port).sync();</span><br><span class="line"></span><br><span class="line">    f.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¼˜é›…å…³é—­ç›¸å…³çº¿ç¨‹ç»„èµ„æº</span></span><br><span class="line"></span><br><span class="line">    group.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ServerBootstrap</code> å®¢æˆ·ç«¯çš„å¯åŠ¨å¼•å¯¼ç±»/è¾…åŠ©ç±»ï¼Œå…·ä½“ä½¿ç”¨æ–¹æ³•å¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">// 1.bossGroup ç”¨äºæ¥æ”¶è¿æ¥ï¼ŒworkerGroup ç”¨äºå…·ä½“çš„å¤„ç†</span></span><br><span class="line"></span><br><span class="line">    EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.åˆ›å»ºæœåŠ¡ç«¯å¯åŠ¨å¼•å¯¼/è¾…åŠ©ç±»ï¼šServerBootstrap</span></span><br><span class="line"></span><br><span class="line">        ServerBootstrap b = <span class="keyword">new</span> ServerBootstrap();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.ç»™å¼•å¯¼ç±»é…ç½®ä¸¤å¤§çº¿ç¨‹ç»„,ç¡®å®šäº†çº¿ç¨‹æ¨¡å‹</span></span><br><span class="line"></span><br><span class="line">        b.group(bossGroup, workerGroup).</span><br><span class="line"></span><br><span class="line">               ......</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6.ç»‘å®šç«¯å£</span></span><br><span class="line"></span><br><span class="line">        ChannelFuture f = b.bind(port).sync();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…è¿æ¥å…³é—­</span></span><br><span class="line"></span><br><span class="line">        f.channel().closeFuture().sync();</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//7.ä¼˜é›…å…³é—­ç›¸å…³çº¿ç¨‹ç»„èµ„æº</span></span><br><span class="line"></span><br><span class="line">        bossGroup.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">        workerGroup.shutdownGracefully();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä»ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼š</p>
<ol>
<li><code>Bootstrap</code> é€šå¸¸ä½¿ç”¨ <code>connet()</code> æ–¹æ³•è¿æ¥åˆ°è¿œç¨‹çš„ä¸»æœºå’Œç«¯å£ï¼Œä½œä¸ºä¸€ä¸ª Netty TCP åè®®é€šä¿¡ä¸­çš„å®¢æˆ·ç«¯ã€‚å¦å¤–ï¼Œ<code>Bootstrap</code> ä¹Ÿå¯ä»¥é€šè¿‡ <code>bind()</code> æ–¹æ³•ç»‘å®šæœ¬åœ°çš„ä¸€ä¸ªç«¯å£ï¼Œä½œä¸º UDP åè®®é€šä¿¡ä¸­çš„ä¸€ç«¯ã€‚</li>
<li><code>ServerBootstrap</code>é€šå¸¸ä½¿ç”¨ <code>bind()</code> æ–¹æ³•ç»‘å®šæœ¬åœ°çš„ç«¯å£ä¸Šï¼Œç„¶åç­‰å¾…å®¢æˆ·ç«¯çš„è¿æ¥ã€‚</li>
<li><code>Bootstrap</code> åªéœ€è¦é…ç½®ä¸€ä¸ªçº¿ç¨‹ç»„â€” <code>EventLoopGroup</code> ,è€Œ <code>ServerBootstrap</code>éœ€è¦é…ç½®ä¸¤ä¸ªçº¿ç¨‹ç»„â€” <code>EventLoopGroup</code> ï¼Œä¸€ä¸ªç”¨äºæ¥æ”¶è¿æ¥ï¼Œä¸€ä¸ªç”¨äºå…·ä½“çš„å¤„ç†ã€‚</li>
</ol>
<h2 id="NioEventLoopGroup-é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹ï¼Ÿ"><a href="#NioEventLoopGroup-é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹ï¼Ÿ" class="headerlink" title="NioEventLoopGroup é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹ï¼Ÿ"></a>NioEventLoopGroup é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹ï¼Ÿ</h2><p>ğŸ‘¨â€ğŸ’»<strong>é¢è¯•å®˜</strong> ï¼šçœ‹è¿‡ Netty çš„æºç äº†ä¹ˆï¼Ÿ<code>NioEventLoopGroup</code> é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹å‘¢ï¼Ÿ</p>
<p>ğŸ™‹ <strong>æˆ‘</strong> ï¼šå—¯å—¯ï¼çœ‹è¿‡éƒ¨åˆ†ã€‚</p>
<p>å›é¡¾æˆ‘ä»¬åœ¨ä¸Šé¢å†™çš„æœåŠ¡å™¨ç«¯çš„ä»£ç ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1.bossGroup ç”¨äºæ¥æ”¶è¿æ¥ï¼ŒworkerGroup ç”¨äºå…·ä½“çš„å¤„ç†</span></span><br><span class="line"></span><br><span class="line">EventLoopGroup bossGroup = <span class="keyword">new</span> NioEventLoopGroup(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">EventLoopGroup workerGroup = <span class="keyword">new</span> NioEventLoopGroup();</span><br></pre></td></tr></table></figure>
<p>ä¸ºäº†ææ¸…æ¥š<code>NioEventLoopGroup</code> é»˜è®¤çš„æ„é€ å‡½æ•° åˆ°åº•åˆ›å»ºäº†å¤šå°‘ä¸ªçº¿ç¨‹ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹å®ƒçš„æºç ã€‚</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * æ— å‚æ„é€ å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * nThreads:0</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//è°ƒç”¨ä¸‹ä¸€ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * Executorï¼šnull</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//ç»§ç»­è°ƒç”¨ä¸‹ä¸€ä¸ªæ„é€ æ–¹æ³•</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>(nThreads, (Executor) <span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸­é—´çœç•¥éƒ¨åˆ†æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> * RejectedExecutionHandlerï¼ˆï¼‰ï¼šRejectedExecutionHandlers.reject()</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">NioEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, Executor executor, <span class="keyword">final</span> SelectorProvider selectorProvider,<span class="keyword">final</span> SelectStrategyFactory selectStrategyFactory)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//å¼€å§‹è°ƒç”¨çˆ¶ç±»çš„æ„é€ å‡½æ•°</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>(nThreads, executor, selectorProvider, selectStrategyFactory, RejectedExecutionHandlers.reject());</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸€ç›´å‘ä¸‹èµ°ä¸‹å»çš„è¯ï¼Œä½ ä¼šå‘ç°åœ¨ <code>MultithreadEventLoopGroup</code> ç±»ä¸­æœ‰ç›¸å…³çš„æŒ‡å®šçº¿ç¨‹æ•°çš„ä»£ç ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä»1ï¼Œç³»ç»Ÿå±æ€§ï¼ŒCPUæ ¸å¿ƒæ•°*2 è¿™ä¸‰ä¸ªå€¼ä¸­å–å‡ºä¸€ä¸ªæœ€å¤§çš„</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//å¯ä»¥å¾—å‡º DEFAULT_EVENT_LOOP_THREADS çš„å€¼ä¸ºCPUæ ¸å¿ƒæ•°*2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_EVENT_LOOP_THREADS = Math.max(<span class="number">1</span>, SystemPropertyUtil.getInt(<span class="string">&quot;io.netty.eventLoopThreads&quot;</span>, NettyRuntime.availableProcessors() * <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¢«è°ƒç”¨çš„çˆ¶ç±»æ„é€ å‡½æ•°ï¼ŒNioEventLoopGroup é»˜è®¤çš„æ„é€ å‡½æ•°ä¼šèµ·å¤šå°‘çº¿ç¨‹çš„ç§˜å¯†æ‰€åœ¨</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“æŒ‡å®šçš„çº¿ç¨‹æ•°nThreadsä¸º0æ—¶ï¼Œä½¿ç”¨é»˜è®¤çš„çº¿ç¨‹æ•°DEFAULT_EVENT_LOOP_THREADS</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">protected</span> <span class="title">MultithreadEventLoopGroup</span><span class="params">(<span class="keyword">int</span> nThreads, ThreadFactory threadFactory, Object... args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">super</span>(nThreads == <span class="number">0</span> ? DEFAULT_EVENT_LOOP_THREADS : nThreads, threadFactory, args);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç»¼ä¸Šï¼Œæˆ‘ä»¬å‘ç° <code>NioEventLoopGroup</code> é»˜è®¤çš„æ„é€ å‡½æ•°å®é™…ä¼šèµ·çš„çº¿ç¨‹æ•°ä¸º <strong>CPUæ ¸å¿ƒæ•°*2</strong>ã€‚</p>
<p>å¦å¤–ï¼Œå¦‚æœä½ ç»§ç»­æ·±å…¥ä¸‹å»çœ‹æ„é€ å‡½æ•°çš„è¯ï¼Œä½ ä¼šå‘ç°æ¯ä¸ª<code>NioEventLoopGroup</code>å¯¹è±¡å†…éƒ¨éƒ½ä¼šåˆ†é…ä¸€ç»„<code>NioEventLoop</code>ï¼Œå…¶å¤§å°æ˜¯ <code>nThreads</code>, è¿™æ ·å°±æ„æˆäº†ä¸€ä¸ªçº¿ç¨‹æ± ï¼Œ ä¸€ä¸ª<code>NIOEventLoop</code> å’Œä¸€ä¸ªçº¿ç¨‹ç›¸å¯¹åº”ï¼Œè¿™å’Œæˆ‘ä»¬ä¸Šé¢è¯´çš„ <code>EventloopGroup</code> å’Œ <code>EventLoop</code>å…³ç³»è¿™éƒ¨åˆ†å†…å®¹ç›¸å¯¹åº”ã€‚</p>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">Jia Xufeng</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://icool8.cn/2018/10/01/Blog/java/netty/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B9%8B%20Netty%EF%BC%88%E4%B8%8A%EF%BC%89/">https://icool8.cn/2018/10/01/Blog/java/netty/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B9%8B%20Netty%EF%BC%88%E4%B8%8A%EF%BC%89/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/NIO/">NIO</a></div><div class="post-qr-code"><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://image.icool8.cn/bolg/20210107114718.png"><div class="post-qr-code__desc">æ”¯ä»˜å®æ‰“èµ</div></div><div class="post-qr-code-item"><img class="post-qr-code__img" src="http://image.icool8.cn/bolg/20210107114632.png"><div class="post-qr-code__desc">å¾®ä¿¡æ‰“èµ</div></div></div><nav id="pagination"><div class="prev-post pull-left"><a href="/2018/10/02/Blog/java/netty/%E5%B8%B8%E8%A7%81%E9%97%AE%E9%A2%98%E4%B9%8B%20Netty%EF%BC%88%E4%B8%8B%EF%BC%89/"><i class="fa fa-chevron-left">  </i><span>å¸¸è§é—®é¢˜ä¹‹ Nettyï¼ˆä¸‹ï¼‰</span></a></div><div class="next-post pull-right"><a href="/2018/09/23/Blog/Elasticsearch/Elasticsearch%E7%9A%84%E6%9F%A5%E8%AF%A2%E8%BF%87%E7%A8%8B/"><span>Elasticsearchçš„æŸ¥è¯¢è¿‡ç¨‹</span><i class="fa fa-chevron-right"></i></a></div></nav></div></div><footer class="footer-bg" style="background-image: url(http://image.icool8.cn/bolg/20210107113114.png)"><div class="layout" id="footer"><div class="copyright">&copy;2013 - 2021 By Jia Xufeng</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="footer_custom_text">hitokoto</div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_page_pv"><i class="fa fa-file"></i><span id="busuanzi_value_page_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.7.0"></script><script src="/js/fancybox.js?version=1.7.0"></script><script src="/js/sidebar.js?version=1.7.0"></script><script src="/js/copy.js?version=1.7.0"></script><script src="/js/fireworks.js?version=1.7.0"></script><script src="/js/transition.js?version=1.7.0"></script><script src="/js/scroll.js?version=1.7.0"></script><script src="/js/head.js?version=1.7.0"></script><script>if(/Android|webOS|iPhone|iPod|iPad|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
  $('#top-container').addClass('is-mobile')
}</script></body></html>